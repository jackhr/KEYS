const STATE={configFP:{enableTime:!0,altInput:!0,altFormat:"F j, Y h:i K",dateFormat:"Y-m-d H:i",minDate:"today"},pickUpFP:null,returnFP:null};function handleInvalidFormData(e,t){let n;return"itinerary"===t?"Choose Office"!==e.pickUpLocation&&e.pickUpLocation?e.pickUpDate.date?isWithinBusinessHours(e.pickUpDate.date)?e.returnToSameLocation.checked||"Choose Office"!==e.returnLocation&&e.returnLocation?e.returnDate.date?isWithinBusinessHours(e.returnDate.date)?pickUpDateIsSameAsReturnDate(e)?(n="You cannot pick up and return the car on the same day.",element=$("#pick-up-flatpickr + input, #return-flatpickr + input")):pickUpDateIsAfterReturnDate(e)&&(n="You have to return the car at least one day after pick up.",element=$("#pick-up-flatpickr + input, #return-flatpickr + input")):(n="Return time must be between 8am and 6pm.",element=$("#return-flatpickr + input")):(n="Please select a return date.",element=$("#return-flatpickr + input")):(n="Please select a return location.",element=$(".custom-select.return")):(n="Pick up time must be between 8am and 6pm.",element=$("#pick-up-flatpickr + input")):(n="Please select a pick up date.",element=$("#pick-up-flatpickr + input")):(n="Please select a pick up location.",element=$(".custom-select.pick-up")):"final_details"===t?""===e.first_name?(n="Please enter your first name.",element=$('#final-details-form input[name="first-name"]')):""===e.last_name?(n="Please enter your last name.",element=$('#final-details-form input[name="last-name"]')):""===e.phone?(n="Please enter your phone number.",element=$('#final-details-form input[name="phone"]')):""===e.email&&(n="Please enter your email address.",element=$('#final-details-form input[name="email"]')):"contact"===t&&(""===e.name?(n="Please enter your name.",element=$('#contact-form-section input[name="name"]')):""===e.email?(n="Please enter your email address.",element=$('#contact-form-section input[name="email"]')):""===e.message&&(n="Please enter your message.",element=$('#contact-form-section textarea[name="message"]'))),n&&(Swal.fire({text:n,title:"Incomplete form",icon:"warning",confirmButtonText:"Ok"}),element.addClass("form-error")),!n}function isWithinBusinessHours(e){e="string"==typeof e?new Date(e):e;const t=e?.getHours?.();return t>=8&&t<=18}function pickUpDateIsSameAsReturnDate(e){return getDayFromDate(e.pickUpDate.altValue)===getDayFromDate(e.returnDate.altValue)&&e.pickUpDate.ts+864e5>e.returnDate.ts}function pickUpDateIsAfterReturnDate(e){const t=getDayFromDate(e.pickUpDate.altValue),n=getDayFromDate(e.returnDate.altValue);return getYearFromDate(e.pickUpDate.altValue)>getYearFromDate(e.returnDate.altValue)||t>n&&e.pickUpDate.ts-864e5>e.returnDate.ts}function getDayFromDate(e){if(e)return Number(e.split(",")[0].split(" ")[1])}function getYearFromDate(e){if(e)return Number(e.split(", ")[1].split(" ")[0])}function goToAddOns(){$("#vehicle-selection-section").hide(),$("#vehicle-add-ons").show()}function getDifferenceInDays(e,t){const n=new Date(Number(e)),a=new Date(Number(t)),i=Math.abs(a-n);return Math.ceil(i/864e5)}function makePriceString(e,t=1,n="USD"){return"USD"!==n&&"EC"!==n&&(n="USD"),`$${n}${parseInt(e)*t}`}function getAddOnCostForTotalDays(e,t=1){let n=Number(e.cost);return"1"!==e.fixed_price&&(n*=t),n}function getAddOnsSubTotal(e){let t=0;if(e.add_ons){let n=1;if(e.vehicle&&e.itinerary){e.itinerary;n=getDifferenceInDays(e.itinerary.pickUpDate.ts,e.itinerary.returnDate.ts)}for(const a in e.add_ons){const i=e.add_ons[a];console.log(i),t+=getAddOnCostForTotalDays(i,n)}}return t}$((function(){STATE.pickUpFP=$("#pick-up-flatpickr").flatpickr?.(STATE.configFP),STATE.returnFP=$("#return-flatpickr").flatpickr?.(STATE.configFP),$(".checkbox-container").on("click",(function(){const e=$(this).find("input"),t=e.prop("checked"),n="reservation-page"===$("body").prop("id")?$(".custom-select.return").parent("div"):$(".custom-select.return");e.prop("checked",!t),n.slideToggle(!t)})),$(".custom-select").on("click",(function(){$(".custom-select").removeClass("active"),$(this).addClass("active"),$("html").addClass("viewing-custom-select-options")})),$(".custom-select-options span").on("click",(function(e){e.stopPropagation(),$("html").removeClass("viewing-custom-select-options"),$(this).siblings().removeClass("selected"),$(this).addClass("selected");const t=$(this).text();$(".custom-select.active > span").text(t),$(".custom-select").removeClass("active")})),$("body .overlay").on("click",(function(){$("html").hasClass("viewing-custom-select-options")&&$("html").removeClass("viewing-custom-select-options"),$("html").hasClass("viewing-hamburger-menu")&&$("html").removeClass("viewing-hamburger-menu")})),$("#intro-section form").on("submit",(async function(e){e.preventDefault(),$(".form-input").removeClass("form-error");const t=$("#return-to-same-location").prop("checked"),n=$(".pick-up .custom-select-options span.selected").text(),a={action:"itinerary",pickUpLocation:n,returnLocation:t?n:$(".return .custom-select-options span.selected").text(),returnToSameLocation:{checked:t,value:t?"on":"off"},pickUpDate:{date:STATE.pickUpFP.selectedDates[0].toISOString(),ts:STATE.pickUpFP.selectedDates[0]?.getTime?.(),value:STATE.pickUpFP.input.value,altValue:STATE.pickUpFP.altInput.value},returnDate:{date:STATE.returnFP.selectedDates[0].toISOString(),ts:STATE.returnFP.selectedDates[0]?.getTime?.(),value:STATE.returnFP.input.value,altValue:STATE.returnFP.altInput.value},step:2};handleInvalidFormData(a,"itinerary")&&(location.href=`/reservation/?itinerary[pickUpLocation]=${a.pickUpLocation}&itinerary[returnLocation]=${a.returnLocation}&itinerary[returnToSameLocation][checked]=${t+0}&itinerary[returnToSameLocation][value]=${t?"on":"off"}&itinerary[pickUpDate][date]=${a.pickUpDate.date}&itinerary[pickUpDate][ts]=${a.pickUpDate.ts}&itinerary[pickUpDate][value]=${a.pickUpDate.value}&itinerary[pickUpDate][altValue]=${a.pickUpDate.altValue}&itinerary[returnDate][date]=${a.returnDate.date}&itinerary[returnDate][ts]=${a.returnDate.ts}&itinerary[returnDate][value]=${a.returnDate.value}&itinerary[returnDate][altValue]=${a.returnDate.altValue}&step=2`)})),$(".faq").on("click",(function(){$(this).toggleClass("open"),$(this).find(".faq-answer").slideToggle()})),$(".reservation-step").on("click",(function(){if($(this).hasClass("active"))return;const e=$(this).data("step");$(".reservation-step").removeClass("active"),$(this).addClass("active"),$("section[data-step]").hide(),$(`section[data-step="${e}"]`).first().show()})),$(".vehicle-container .continue-btn").on("click",(async function(){const e=$(this).closest(".vehicle-container"),t=e.data("vehicle-id"),n=e.find(".vehicle-name").text(),a=e.find(".vehicle-type").text(),i=e.children("img").attr("src"),r={action:"vehicle",step:2,id:t,name:n,type:a,imgSrc:i},s=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),o=await s.json();await Swal.fire({title:`Choosing ${n} (${a})...`,timer:1500,didOpen:()=>Swal.showLoading()}),$(".vehicle-container").removeClass("active"),e.addClass("active").find(".continue-btn").text("CONTINUE"),$(".reservation-step.vehicle-add-on .body>div:first h6, #reservation-summary>h5").text(n),$(".reservation-step.vehicle-add-on .body>div:first p, #reservation-summary>h6").text(a),$("#reservation-summary div.car.summary").html(`<img src="${i}" alt="${n}">`);let c=Number(o.vehicle.price_day_USD),l=1,d=!1;o.itinerary&&(l=getDifferenceInDays(o.itinerary.pickUpDate.ts,o.itinerary.returnDate.ts),1===Number(o.vehicle.uses_discount)&&l>=2&&(d=!0,c=Number(o.vehicle.price_day_low_USD)));const u={days:l,rate:makePriceString(c),subtotal:makePriceString(c)};o.itinerary&&(u.subtotal=makePriceString(c,u.days));let p=u.rate;d&&(p+=`<div class="discount-tool-tip">i<div><span>Fixed price:</span><span><b>2</b> days or more: <b>${u.rate}</b></span></div></div>`),$("#reservation-summary div.rate.summary").html(`\n<h6>Rate</h6>\n<table>\n<thead>\n<tr>\n<th>Day(s)</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>${u.days}</td>\n<td>${p}</td>\n<td>${u.subtotal}</td>\n</tr>\n</tbody>\n</table>\n`);const m=o.add_ons?Object.values(o.add_ons).reduce(((e,t)=>e+parseInt(t.cost)),0):0;$("#reservation-summary .estimated-total span:last-child").text(makePriceString(m+c*u.days)),goToAddOns()})),$(".more-add-on-info").on("click",(function(){const e=$(this).closest(".add-on-container"),t=e.hasClass("viewing-info");e.toggleClass("viewing-info",!t),e.children("p").slideToggle(!t)})),$(".add-on-btn").on("click",(async function(){const e=$(this).closest(".add-on-container"),t={action:$(this).hasClass("added")?"remove_add_on":"add_add_on",id:e.data("id")},n=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();let i=Number(a.vehicle.price_day_USD),r=1;a.itinerary&&(r=getDifferenceInDays(a.itinerary.pickUpDate.ts,a.itinerary.returnDate.ts),1===Number(a.vehicle.uses_discount)&&r>=2&&(i=Number(a.vehicle.price_day_low_USD)));let s="",o="",c="",l=0;for(const e in a.add_ons){l++;const t=a.add_ons[e];let n=`1 x ${t.name}`;"1"!==t.fixed_price&&(n+=` for ${r} day(s)`),s+=`\n<tr data-id="${t.id}">\n<td>${n}</td>\n<td>${makePriceString(t.cost)}</td>\n<td>${makePriceString(getAddOnCostForTotalDays(t,r))}</td>\n</tr>\n`,o+=`${l>1?", ":""}<span data-id="${t.id}">${t.abbr}</span>`}const d=getAddOnsSubTotal(a);console.log("totalAddOnsCost:",d),c=s.length?`\n<h6>Add-ons</h6>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Rate</th>\n<th>Subtotal</th>\n</tr>\n</thead>\n<tbody>\n${s}\n<tr>\n<td>Add-ons Subtotal</td>\n<td></td>\n<td>${makePriceString(d)}</td>\n</tr>\n</tbody>\n</table>\n`:"\n<h6>Add-ons</h6>\n<div><span>--</span><span>--</span><span>--</span></div>\n";let u=1;a.itinerary&&(u=getDifferenceInDays(a.itinerary.pickUpDate.ts,a.itinerary.returnDate.ts));const p=parseInt(i)*u;$("#reservation-summary div.add-ons.summary").html(c),$(".reservation-step.vehicle-add-on .body > div:last-child p").html(o||"--"),$("#reservation-summary .estimated-total span:last-child").text(makePriceString(d+p)),$(this).hasClass("added")?($(this).removeClass("added"),$(this).addClass("show-removed"),setTimeout((()=>$(this).removeClass("show-removed")),1e3)):($(this).addClass("added show-added"),setTimeout((()=>$(this).removeClass("show-added")),1e3))})),$(".change-car-btn, .car.summary > div").off("click").on("click",(function(){$(".reservation-step.vehicle-add-on .header").trigger("click"),$("section[data-step]").hide(),$("#vehicle-selection-section").show()})),$("#vehicle-add-ons .continue-btn:not(.change-car-btn)").on("click",(function(){$(".reservation-step[data-step='3'] .header").click()})),$("#itinerary-section .continue-btn:not(.change-car-btn)").on("click",(async function(){$(".form-input").removeClass("form-error");const e=$("#return-to-same-location").prop("checked"),t=$(".reservation-flow-container .pick-up .custom-select-options span.selected").text(),n={action:"itinerary",pickUpLocation:t,returnLocation:e?t:$(".reservation-flow-container .return .custom-select-options span.selected").text(),returnToSameLocation:{checked:e,value:e?"on":"off"},pickUpDate:{date:STATE.pickUpFP.selectedDates[0],ts:STATE.pickUpFP.selectedDates[0]?.getTime?.(),value:STATE.pickUpFP.input.value,altValue:STATE.pickUpFP.altInput.value},returnDate:{date:STATE.returnFP.selectedDates[0],ts:STATE.returnFP.selectedDates[0]?.getTime?.(),value:STATE.returnFP.input.value,altValue:STATE.returnFP.altInput.value},step:2};if(!handleInvalidFormData(n,"itinerary"))return;const a=await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});await a.json(),$(".reservation-step.itinerary .body>div:first-child p").text(`${n.pickUpLocation} - ${n.pickUpDate.altValue}`),$(".reservation-step.itinerary .body>div:last-child p").text(`${n.returnLocation} - ${n.returnDate.altValue}`),Swal.fire({title:"Setting Itinerary...",timer:1e3,didOpen:()=>Swal.showLoading()}).then((()=>$(".reservation-step.vehicle-add-on .header").trigger("click")))})),$(".form-input").on("focus change input click",(function(){$(this).removeClass("form-error")})),$(".reset-data").on("click",(async function(){(await Swal.fire({icon:"warning",title:"Are you sure you want to reset the form?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"})).isConfirmed&&(await fetch("/includes/reservation.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reset_reservation"})}),location.href="/reservation/")})),$("#hamburger-button").on("click",(function(){$("html").addClass("viewing-hamburger-menu")})),$("#close-hamburger").on("click",(function(){$("html").removeClass("viewing-hamburger-menu")})),$("#final-details-form .continue-btn").on("click",(async function(){const e={"first-name":$('#final-details-form input[name="first-name"]').val(),"last-name":$('#final-details-form input[name="last-name"]').val(),"driver-license":$('#final-details-form input[name="driver-license"]').val(),"country-region":$('#final-details-form input[name="country-region"]').val(),street:$('#final-details-form input[name="street"]').val(),"town-city":$('#final-details-form input[name="town-city"]').val(),"state-county":$('#final-details-form input[name="state-county"]').val(),phone:$('#final-details-form input[name="phone"]').val(),email:$('#final-details-form input[name="email"]').val(),h826r2whj4fi_cjz8jxs2zuwahhhk6:""};if(!handleInvalidFormData(e,"final_details"))return;Swal.fire({title:"Sending request...",didOpen:()=>Swal.showLoading()});const t=await fetch("/includes/vehicle-request-send.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();n.success?location.href=`/confirmation.php?key=${n.data.key}`:Swal.fire({title:"Error",text:n.message,icon:"error",confirmButtonText:"Ok"})})),$("#contact-form-section form").on("submit",(async function(e){e.preventDefault();const t={name:$('#contact-form-section input[name="name"]').val(),email:$('#contact-form-section input[name="email"]').val(),message:$('#contact-form-section textarea[name="message"]').val(),h826r2whj4fi_cjz8jxs2zuwahhhk6:""};if(!handleInvalidFormData(t,"contact"))return;Swal.fire({title:"Submitting form...",didOpen:()=>Swal.showLoading()});const n=await fetch("/includes/contact-send.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();Swal.fire({title:a.success?"Success":a.message,text:a.success?"Your message has been sent successfully.":"error",icon:a.success?"Success":"Error"})}))}));